/*!
 * VERSION: 0.4.0
 * DATE: 2015-09-15
 * GIT:https://github.com/shrekshrek/css3d-engine
 *
 * @author: Shrek.wang, shrekshrek@gmail.com
 **/

!function(t){var i="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"function"==typeof define&&define.amd?define(["exports"],function(e){i.C3D=t(i,e)}):"undefined"!=typeof exports?t(i,exports):i.C3D=t(i,{})}(function(t,i){var e=t.C3D;i.VERSION="0.4.0",i.noConflict=function(){return t.C3D=e,this};var s=function(t){var i=[];for(var e in t)i.push(e);return i},n=function(t){var i=arguments.length;if(2>i||null==t)return t;for(var e=1;i>e;e++)for(var n=arguments[e],h=s(n),a=h.length,r=0;a>r;r++){var o=h[r];t[o]=n[o]}return t},h=function(t,i){var e,s=this;e=t&&Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},n(e,s,i);var h=function(){this.constructor=e};return h.prototype=s.prototype,e.prototype=new h,t&&n(e.prototype,t),e.__super__=s.prototype,e},a="";return function(){var t=document.createElement("div"),i=["Webkit","Moz","Ms","O"];for(var e in i)if(i[e]+"Transform"in t.style){a=i[e];break}}(),i.getRandomColor=function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},i.rgb2hex=function(t,i,e){return(t<<16|i<<8|e).toString(16)},i.hex2rgb=function(t){var i=Math.floor("0x"+t),e=i>>16&255,s=i>>8&255,n=255&i;return[e,s,n]},i.Object3D=function(){this.init.apply(this,arguments)},n(i.Object3D.prototype,{x:0,y:0,z:0,position:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},move:function(t,i,e){return this.x+=t,this.y+=i,this.z+=e,this},rotationX:0,rotationY:0,rotationZ:0,rotation:function(t,i,e){return this.rotationX=t,this.rotationY=i,this.rotationZ=e,this},rotate:function(t,i,e){return this.rotationX+=t,this.rotationY+=i,this.rotationZ+=e,this},scaleX:1,scaleY:1,scaleZ:1,scale:function(t,i,e){return this.scaleX=t,this.scaleY=i,this.scaleZ=e,this},width:0,height:0,depth:0,size:function(t,i,e){return this.width=t,this.height=i,this.depth=e,this},init:function(){this.x=0,this.y=0,this.z=0,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.width=0,this.height=0,this.depth=0,this.children=[]},destroy:function(){for(var t in this.children)this.children[t].destroy();this.children=[]},parent:null,children:null,addChild:function(t){t.parent&&t.parent.removeChild(t);for(var i in this.children)if(this.children[i]===t)return this;return t.parent=this,this.children.push(t),this},removeChild:function(t){for(var i=this,e=this.children.length-1;e>=0;e--)if(this.children[e]===t)return i.children.splice(e,1),t.parent=null,this;return this}}),i.Object3D.extend=h,i.Sprite3D=i.Object3D.extend({el:null,mat:null,init:function(t){i.Sprite3D.__super__.init.apply(this,[t]);var e,s;t&&t.el?(e=t.el,s=e.style,this.width=parseInt(s.width),this.height=parseInt(s.height),"static"===s.position&&(s.position="relative")):(e=document.createElement("div"),s=e.style,s.position="absolute"),e.style[a+"Transform"]="translateZ(0px)",e.style[a+"TransformStyle"]="preserve-3d",this.el=e,e.le=this},destroy:function(){i.Sprite3D.__super__.destroy.apply(this),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},update:function(){return this.updateS(),this.updateM(),this.updateT(),this},updateS:function(){return this},updateM:function(){return this.mat?(this.mat.image&&(this.el.style.backgroundImage=""!==this.mat.image?"url("+this.mat.image+")":""),this.mat.color&&(this.el.style.backgroundColor=this.mat.color),this.mat.position&&(this.el.style.backgroundPosition=this.mat.position),this.mat.size&&(this.el.style.backgroundSize=this.mat.size),this.mat.repeat&&(this.el.style.backgroundRepeat=this.mat.repeat),this.mat.origin&&(this.el.style.backgroundOrigin=this.mat.origin),this.mat.alpha&&(this.el.style.opacity=this.mat.alpha),this):this},updateT:function(){return this.el.style[a+"Transform"]="translate3d("+this.x+"px,"+this.y+"px,"+this.z+"px) rotateX("+this.rotationX+"deg) rotateY("+this.rotationY+"deg) rotateZ("+this.rotationZ+"deg) scale3d("+this.scaleX+", "+this.scaleY+", "+this.scaleZ+") ",this},addChild:function(t){return i.Sprite3D.__super__.addChild.apply(this,[t]),this.el&&t.el&&this.el.appendChild(t.el),this},removeChild:function(t){return i.Sprite3D.__super__.removeChild.apply(this,[t]),t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el),this},on:function(t){if("object"==typeof t)for(var i in t)this.el.addEventListener(i,t[i],!1);else 2===arguments.length?this.el.addEventListener(arguments[0],arguments[1],!1):3===arguments.length&&this.el.addEventListener(arguments[0],arguments[1],arguments[2]);return this},off:function(t){if("object"==typeof t)for(var i in t)this.el.removeEventListener(i,t[i],!1);else 2===arguments.length&&this.el.removeEventListener(arguments[0],arguments[1],!1);return this},buttonMode:function(t){return this.el.style.cursor=t?"pointer":"auto",this},material:function(t){return this.mat=t,this}}),i.Stage=i.Sprite3D.extend({camera:null,__fix1:null,__fix2:null,init:function(t){i.Stage.__super__.init.apply(this,[t]),t&&t.el||(this.el.style.top="0px",this.el.style.left="0px",this.el.style.width="0px",this.el.style.height="0px"),this.el.style[a+"Perspective"]="800px",this.el.style[a+"TransformStyle"]="flat",this.el.style[a+"Transform"]="",this.el.style.overflow="hidden",this.__fix1=new i.Sprite3D,this.__fix1.el.style.top="50%",this.__fix1.el.style.left="50%",this.el.appendChild(this.__fix1.el),this.__fix2=new i.Sprite3D,this.__fix1.el.appendChild(this.__fix2.el),this.camera=new i.Camera},updateS:function(){return this.el.style.width=parseInt(this.width)+"px",this.el.style.height=parseInt(this.height)+"px",this},updateT:function(){var t=.5/Math.tan(.5*this.camera.fov/180*Math.PI)*this.height;return this.el.style[a+"Perspective"]=t+"px",this.__fix1.position(0,0,t).rotation(-this.camera.rotationX,-this.camera.rotationY,-this.camera.rotationZ).updateT(),this.__fix2.position(-this.camera.x,-this.camera.y,-this.camera.z).updateT(),this},addChild:function(t){return this.__fix2.addChild(t),this},removeChild:function(t){return this.__fix2.removeChild(t),this}}),i.Camera=i.Object3D.extend({fov:null,init:function(t){i.Camera.__super__.init.apply(this,[t]),this.fov=75}}),i.Plane=i.Sprite3D.extend({init:function(t){i.Plane.__super__.init.apply(this,[t])},updateS:function(){var t=parseInt(this.width),i=parseInt(this.height),e=0;return this.el.style.width=t+"px",this.el.style.height=i+"px",this.el.style[a+"TransformOrigin"]=t/2+"px "+i/2+"px "+e/2+"px ",this},updateT:function(){var t=parseInt(this.width),i=parseInt(this.height),e=0;return this.el.style[a+"Transform"]="translate3d("+(this.x-t/2)+"px,"+(this.y-i/2)+"px,"+(this.z-e/2)+"px) rotateX("+this.rotationX+"deg) rotateY("+this.rotationY+"deg) rotateZ("+this.rotationZ+"deg) scale3d("+this.scaleX+", "+this.scaleY+", "+this.scaleZ+") ",this}}),i.Cube=i.Sprite3D.extend({front:null,back:null,left:null,right:null,up:null,down:null,init:function(t){i.Cube.__super__.init.apply(this,[t]),this.front=new i.Plane,this.addChild(this.front),this.back=new i.Plane,this.addChild(this.back),this.left=new i.Plane,this.addChild(this.left),this.right=new i.Plane,this.addChild(this.right),this.up=new i.Plane,this.addChild(this.up),this.down=new i.Plane,this.addChild(this.down)},updateS:function(){var t=parseInt(this.width),i=parseInt(this.height),e=parseInt(this.depth);return this.front.size(t,i,0).position(0,0,-e/2).rotation(0,0,0).updateS().updateT(),this.back.size(t,i,0).position(0,0,e/2).rotation(0,180,0).updateS().updateT(),this.left.size(e,i,0).position(-t/2,0,0).rotation(0,90,0).updateS().updateT(),this.right.size(e,i,0).position(t/2,0,0).rotation(0,-90,0).updateS().updateT(),this.up.size(t,e,0).position(0,-i/2,0).rotation(-90,0,0).updateS().updateT(),this.down.size(t,e,0).position(0,i/2,0).rotation(90,0,0).updateS().updateT(),this},updateM:function(){return this.mat?(this.mat.front?this.front.material({image:this.mat.front}).updateM():this.front.material(this.mat).updateM(),this.mat.back?this.back.material({image:this.mat.back}).updateM():this.back.material(this.mat).updateM(),this.mat.left?this.left.material({image:this.mat.left}).updateM():this.left.material(this.mat).updateM(),this.mat.right?this.right.material({image:this.mat.right}).updateM():this.right.material(this.mat).updateM(),this.mat.up?this.up.material({image:this.mat.up}).updateM():this.up.material(this.mat).updateM(),this.mat.down?this.down.material({image:this.mat.down}).updateM():this.down.material(this.mat).updateM(),this):this}}),i});
