<!DOCTYPE HTML>
<head>
    <script src="../underscore.js"></script>
    <script src="../css3d.js"></script>
    <style>
    </style>
</head>
<body>
    <script>
        //创建场景
        var s = new Css3D.Stage();
        s.size("100%", "100%");
        s.material({
            color : "#cccccc"
        });
        s.update();
        document.body.appendChild(s.el);

        //创建一个三维容器（创建以方便分组使用）
        var sp = new Css3D.Sprite3D();
        sp.position(0, 100, -500).rotation(0, 0, 70).update();
        s.addChild(sp);

        var p = new Css3D.Plane();
        p.size(100).position(100, 0, 0).rotation(90, 0, 0).material({
            color : Css3D.getRandomColor()
        }).update();
        sp.addChild(p);

        setTimeout(function() {
            var _o = Css3D.positionRotate3D([p.x(), p.y(), p.z()], [sp.rotationX(), sp.rotationY(), sp.rotationZ()]);
            var _sx = Math.sin(p.rotationX()/180*Math.PI);
            var _cx = Math.cos(p.rotationX()/180*Math.PI);console.log(_sx,_cx);
            var _rx = sp.rotationX() + p.rotationX();
            var _ry = sp.rotationY()*_cx + sp.rotationZ()*_cx + p.rotationY();
            var _rz = -sp.rotationY()*_sx + sp.rotationZ()*_sx + p.rotationZ();
            // var _rx = sp.rotationX() + p.rotationX()*Math.cos(sp.rotationZ()/180*Math.PI);
            // var _ry = sp.rotationY() + p.rotationX()*Math.sin(sp.rotationZ()/180*Math.PI);
            // var _rz = sp.rotationZ() + 0;
            // var _rx = sp.rotationX() - p.rotationY()*Math.sin(sp.rotationZ()/180*Math.PI) + p.rotationX()*Math.cos(sp.rotationZ()/180*Math.PI);
            // var _ry = sp.rotationY() - p.rotationY()*Math.cos(sp.rotationZ()/180*Math.PI) + p.rotationX()*Math.sin(sp.rotationZ()/180*Math.PI);
            // var _rz = sp.rotationZ() + 0;
            // var _rx = sp.rotationX() + p.rotationX()*Math.cos(sp.rotationZ()/180*Math.PI) + p.rotationZ()*Math.cos(sp.rotationY()/180*Math.PI);
            // var _ry = sp.rotationY() + p.rotationX()*Math.sin(sp.rotationZ()/180*Math.PI) + p.rotationZ()*Math.cos(sp.rotationX()/180*Math.PI);
            // var _rz = sp.rotationZ() + p.rotationX()*Math.sin(sp.rotationY()/180*Math.PI) + p.rotationY()*Math.cos(sp.rotationX()/180*Math.PI);

            var p2 = new Css3D.Plane();
            console.log(sp.x() + _o.x, sp.y() + _o.y, sp.z() + _o.z);
            // p2.size(100).position(sp.x() + _o.x, sp.y() + _o.y, sp.z() + _o.z).rotation(_rx1, _ry1, _rz1).material({
            // color : Css3D.getRandomColor()
            // }).update();
            p2.size(100).position(sp.x() + _o.x, sp.y() + _o.y, sp.z() + _o.z).rotation(_rx, _ry, _rz).material({
                color : Css3D.getRandomColor()
            }).update();
            s.addChild(p2);
        }, 1000);

        //响应屏幕调整尺寸
        function resize() {
            s.size(window.innerWidth, window.innerHeight).update();
        };
        window.onresize = function() {
            resize();
        };
        resize();

        //刷新场景
        requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame ||
        function(callback) {
            setTimeout(callback, 1000 / 60);
        };

        function go() {
            p.rotate(0, 0, 1).update();
            // sp.move(0, 1, 0).update();

            // s.camera.move(0,0,-1).rotate(0,0.15,0);
            // s.update();

            requestAnimationFrame(go);
        }

        // requestAnimationFrame(go);

    </script>
</body>